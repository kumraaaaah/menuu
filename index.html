<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Journal Menu</title>
    <meta name="description" content="AR Journal Menu using A-Frame">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
    <a-scene webxr="requiredFeatures: hit-test, local-floor;" vr-mode-ui="enabled: false">
        
        <a-assets>
            <a-asset-item id="journal-model" src="assets/journal.glb"></a-asset-item>

            <video id="pasta-video" autoplay loop="true" crossOrigin="anonymous" src="assets/pasta.mp4"></video>
            <video id="pizza-video" autoplay loop="true" crossOrigin="anonymous" src="assets/pizza.mp4"></video>
        </a-assets>

        <a-camera position="0 1.2 0"></a-camera>

        <a-entity id="menu-container" visible="false">
            <a-gltf-model id="journal" src="#journal-model" scale="0.01 0.01 0.01" rotation="-90 0 0"></a-gltf-model>
            
            <a-plane id="food-display" position="0 0.02 0.15" width="0.3" height="0.2" rotation="-90 0 0" material="src: #pasta-video"></a-plane>
        </a-entity>

        <a-entity id="reticle"
            cursor="fuse: false; rayOrigin: mouse;"
            raycaster="objects: .raycast-plane"
            position="0 0 -1"
            scale="0.3 0.3 0.3"
            geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
            material="color: #4CC3D9; shader: flat; opacity: 0.8">
        </a-entity>

    </a-scene>

    <script>
        // --- PLACEHOLDER MENU DATA ---
        const menuData = {
            'italian': ['#pasta-video', '#pizza-video'],
            'chinese': [], // You can add IDs for chinese food videos here
            'default': ['#pasta-video'] 
        };

        let currentFoodIndex = 0;
        let activeMenu = [];

        window.addEventListener('DOMContentLoaded', () => {
            const sceneEl = document.querySelector('a-scene');
            const menuContainer = document.getElementById('menu-container');
            const foodDisplay = document.getElementById('food-display');

            // --- Read the 'cuisine' parameter from the URL ---
            const urlParams = new URLSearchParams(window.location.search);
            const cuisine = urlParams.get('cuisine') || 'default';
            activeMenu = menuData[cuisine];
            foodDisplay.setAttribute('material', 'src', activeMenu[0]);

            // --- Plane Detection & Placement ---
            sceneEl.addEventListener('enter-vr', () => {
                sceneEl.xrSession.addEventListener('select', (event) => {
                    if (!menuContainer.getAttribute('visible')) {
                        const reticle = document.getElementById('reticle');
                        const position = reticle.getAttribute('position');
                        menuContainer.setAttribute('position', position);
                        menuContainer.setAttribute('visible', 'true');
                        reticle.setAttribute('visible', 'false');
                    }
                });
            });

            // --- Swipe/Carousel Logic ---
            let touchStartX = 0;
            document.body.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; });
            document.body.addEventListener('touchend', e => {
                let touchEndX = e.changedTouches[0].clientX;
                if (Math.abs(touchStartX - touchEndX) < 50) return;

                if (touchEndX < touchStartX) { // Swiped Left
                    currentFoodIndex = (currentFoodIndex + 1) % activeMenu.length;
                } else { // Swiped Right
                    currentFoodIndex = (currentFoodIndex - 1 + activeMenu.length) % activeMenu.length;
                }
                foodDisplay.setAttribute('material', 'src', activeMenu[currentFoodIndex]);
            });
        });
    </script>
</body>
</html>
